services:
  postgres:
    image: postgres:13
    container_name: postgres_magnetico
    restart: always
    ports:
      - "5433:5432"  # ✅ 修改外部端口为5433，避免和系统冲突
    environment:
      POSTGRES_DB: magnetico
      POSTGRES_USER: magnetico
      POSTGRES_PASSWORD: magnetico
    volumes:
      - ./Docker/magnetico:/docker-entrypoint-initdb.d      # 初始化脚本路径
      - ./Docker/magnetico/data:/var/lib/postgresql/data    # 数据存储路径
    networks:
      - magnetico_network

  magnetico:
    image: ghcr.io/tgragnato/magnetico:latest
    container_name: magnetico_app
    restart: always
    mem_limit: 1g
    depends_on:
      - postgres
    ports:
      - "8285:8080"  # WebUI 端口（访问：http://IP:8285）
    command: >
      --addr=0.0.0.0:8080
      --database=postgres://magnetico:magnetico@postgres:5432/magnetico?sslmode=disable
      # 注意：这里内部依然连的是容器名 postgres 的 5432 端口，不用改
    networks:
      - magnetico_network

networks:
  magnetico_network:
    driver: bridge